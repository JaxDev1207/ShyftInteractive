<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign In</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #222 0, #050505 55%);
      color: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .card {
      background: rgba(15,15,15,0.95);
      border-radius: 16px;
      padding: 28px;
      width: 100%;
      max-width: 380px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      border: 1px solid #252525;
    }
    h1 {
      margin-top: 0;
      margin-bottom: 4px;
      font-size: 1.6rem;
    }
    p.subtitle {
      margin-top: 0;
      margin-bottom: 18px;
      font-size: 0.9rem;
      color: #a0a0a0;
    }
    button, input {
      font: inherit;
    }
    .btn {
      width: 100%;
      border-radius: 999px;
      padding: 10px 14px;
      border: none;
      cursor: pointer;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.08s ease;
      font-weight: 600;
    }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.5);
      opacity: 0.95;
    }
    .btn:active {
      transform: translateY(0);
      box-shadow: none;
    }
    .btn-discord {
      background: #5865F2;
      color: white;
    }
    .btn-google {
      background: #ffffff;
      color: #202124;
    }
    .btn-primary {
      background: #3b82f6;
      color: white;
    }
    .divider {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 14px 0;
      color: #666;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .divider span {
      flex: 1;
      height: 1px;
      background: #2a2a2a;
    }
    label {
      font-size: 0.8rem;
      color: #c9c9c9;
      display: block;
      margin-bottom: 4px;
    }
    input[type="email"],
    input[type="password"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #333;
      background: #111;
      padding: 9px 12px;
      color: #f5f5f5;
      outline: none;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    input[type="email"]:focus,
    input[type="password"]:focus {
      border-color: #3b82f6;
    }
    .row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 4px;
    }
    .muted {
      font-size: 0.78rem;
      color: #7a7a7a;
      margin-top: 8px;
    }
    .error {
      margin-top: 6px;
      font-size: 0.8rem;
      color: #f97373;
    }
    .success {
      margin-top: 6px;
      font-size: 0.8rem;
      color: #4ade80;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Sign in</h1>
    <p class="subtitle">Use Discord, Google, or email to access your account.</p>

    <!-- OAuth buttons -->
    <button id="discordBtn" class="btn btn-discord">
  <img src="/DiscordLoginButton.png" alt="Discord Login" style="height:28px; margin-right:8px;" />
</button>


    <button id="googleBtn" class="btn btn-google">
      <span>ðŸŸ¢</span> <span>Continue with Google</span>
    </button>

    <div class="divider"><span></span>or use email<span></span></div>

    <!-- Email/password form -->
    <form id="emailForm">
      <label for="email">Email</label>
      <input id="email" type="email" autocomplete="email" required />

      <label for="password">Password</label>
      <input id="password" type="password" autocomplete="current-password" required />

      <div class="row">
        <button type="button" id="loginBtn" class="btn btn-primary">Log in</button>
        <button type="button" id="signupBtn" class="btn" style="background:#111;border:1px solid #333;color:#ddd;">
          Sign up
        </button>
      </div>
    </form>

    <div id="message" class="muted"></div>
    <div id="error" class="error"></div>
    <div id="success" class="success"></div>

    <p class="muted">
      By continuing, you agree to our Terms and acknowledge our Privacy Policy.
    </p>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // 1) Configure your Supabase project here:
    const SUPABASE_URL = "https://lygupyafoyxbcwtflwji.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5Z3VweWFmb3l4YmN3dGZsd2ppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNTk5MjgsImV4cCI6MjA3ODgzNTkyOH0.NF0Qt9iWkd4YB_hShe4bQ2JpPUyi4V9ibbvs6z9Ze5g";
    const POST_LOGIN_REDIRECT = "https://shyftinteractive.com"; // e.g. https://your-site.com/dashboard.html

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const discordBtn = document.getElementById("discordBtn");
    const googleBtn = document.getElementById("googleBtn");
    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");

    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");

    const msgEl = document.getElementById("message");
    const errEl = document.getElementById("error");
    const okEl = document.getElementById("success");

    function setStatus({ msg = "", error = "", success = "" } = {}) {
      msgEl.textContent = msg;
      errEl.textContent = error;
      okEl.textContent = success;
    }

    // 2) OAuth: Discord
    discordBtn.addEventListener("click", async () => {
      setStatus({ msg: "Redirecting to Discord...", error: "" });
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: "discord",
        options: {
          redirectTo: POST_LOGIN_REDIRECT
        }
      });
      if (error) setStatus({ error: error.message });
      // On success, Supabase will redirect; no need to handle data here.
    });

    // 3) OAuth: Google (Gmail)
    googleBtn.addEventListener("click", async () => {
      setStatus({ msg: "Redirecting to Google...", error: "" });
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: "google",
        options: {
          redirectTo: POST_LOGIN_REDIRECT
        }
      });
      if (error) setStatus({ error: error.message });
    });

    // 4) Email/password login
    loginBtn.addEventListener("click", async () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      if (!email || !password) return setStatus({ error: "Please enter email and password." });

      setStatus({ msg: "Signing you in...", error: "", success: "" });

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) return setStatus({ error: error.message });

      setStatus({ success: "Logged in successfully. Redirecting..." });
      window.location.href = POST_LOGIN_REDIRECT;
    });

    // 5) Email/password signup
    signupBtn.addEventListener("click", async () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      if (!email || !password) return setStatus({ error: "Please enter email and password." });

      setStatus({ msg: "Creating your account...", error: "", success: "" });

      const { data, error } = await supabase.auth.signUp({ email, password });
      if (error) return setStatus({ error: error.message });

      setStatus({
        success: "Account created! Check your email to confirm your account if required."
      });
    });

    // 6) Example of reading user + email when they come back from Discord/Google
    (async () => {
      const { data, error } = await supabase.auth.getUser();
      if (data?.user) {
        // You can access their email (from Discord/Google/email) here:
        console.log("Logged in user:", data.user);
        console.log("User email:", data.user.email);
        // Optionally auto-redirect:
        // window.location.href = POST_LOGIN_REDIRECT;
      }
    })();
  </script>
</body>
</html>
